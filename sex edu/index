<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ€§æ•™è‚²è¼”å° - å®‰å…¨é›²ç«¯ç‰ˆ</title>
    <!-- é©ç”¨æ–¼ iPad æ¨¡æ“¬ App çš„è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/1a202c/ffffff?text=SexEd">

    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Poppins å­—é«” - æ›´å¹´è¼•æ´»åŠ› */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        @keyframes gradientShift {
            0%, 100% { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            50% { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        }
        
        #modern-app {
            animation: gradientShift 15s ease infinite;
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .ipad-frame {
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        #input-area {
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .message-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        
        .gradient-text {
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Old School Styles */
        .old-school-page {
            background: #c0c0c0;
            font-family: 'Times New Roman', Times, serif;
        }
        
        .old-school-box {
            background: #ffffff;
            border: 3px solid #808080;
            box-shadow: 3px 3px 0px #000000;
        }
        
        .old-school-button {
            background: #c0c0c0;
            border: 2px outset #ffffff;
            font-family: 'Arial', sans-serif;
            font-size: 14px;
            padding: 8px 24px;
            cursor: pointer;
        }
        
        .old-school-button:active {
            border-style: inset;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .blink {
            animation: blink 1s step-start infinite;
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }
        
        /* Transition Page Styles */
        @keyframes morphBackground {
            0% { background: #000000; }
            25% { background: #1a1a2e; }
            50% { background: #16213e; }
            75% { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%); }
            100% { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        }
        
        @keyframes colorShift {
            0% { color: #00ff00; }
            50% { color: #00ffff; }
            75% { color: #ff00ff; }
            100% { color: #ffffff; }
        }
        
        @keyframes fontTransform {
            0% { 
                font-family: 'Courier New', monospace; 
                font-size: 18px;
            }
            100% { 
                font-family: 'Poppins', sans-serif; 
                font-size: 28px;
            }
        }
        
        .morphing-bg {
            animation: morphBackground 4s ease-in-out forwards;
        }
        
        .color-shift {
            animation: colorShift 3s ease-in-out forwards;
        }
        
        .font-transform {
            animation: fontTransform 3s ease-in-out forwards;
        }
        
        @keyframes scaleUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .scale-up {
            animation: scaleUp 1s ease-out forwards;
        }
    </style>
</head>
<body>

    <!-- Old School Landing Page -->
    <div id="old-school-page" class="old-school-page w-full h-screen flex items-center justify-center">
        <div class="old-school-box p-12 max-w-2xl mx-4">
            <h1 style="font-size: 24px; margin-bottom: 20px; text-align: center; font-weight: bold;">
                AI Sex Education System v1.0
            </h1>
            <hr style="border: 1px solid #808080; margin: 20px 0;">
            <p style="font-size: 16px; line-height: 1.6; margin-bottom: 30px; text-align: center;">
                Welcome to the Artificial Intelligence Sexual Education Advisory System.<br>
                Copyright Â© 1995-2025. All Rights Reserved.<br><br>
                Press the button below to initialize the system.
            </p>
            <div style="text-align: center;">
                <button class="old-school-button" onclick="startSystem()">
                    START SYSTEM
                </button>
            </div>
            <p style="font-size: 12px; margin-top: 30px; text-align: center; color: #666;">
                System Requirements: 486DX/33MHz or higher, 8MB RAM, VGA Display
            </p>
        </div>
    </div>

    <!-- Loading/Transition Page -->
    <div id="loading-page" class="hidden w-full h-screen flex items-center justify-center bg-black">
        <div class="text-center px-4">
            <div id="loading-content" style="font-family: 'Courier New', monospace; color: #00ff00; font-size: 18px; line-height: 1.8;">
                <p id="init-text">INITIALIZING SYSTEM...</p>
                <p id="loading-text">LOADING MODULES... [<span id="progress">0</span>%]</p>
                <p class="blink" id="cursor">_</p>
            </div>
            <div id="transition-content" style="display: none; margin-top: 60px;">
                <p id="joke-text" style="font-family: 'Courier New', monospace; color: #00ff00; font-size: 24px; margin-bottom: 40px;">
                    Just kidding!<br>
                    We're not that old fashion! ğŸ˜„
                </p>
                <p id="upgrade-text" class="color-shift font-transform" style="font-family: 'Courier New', monospace; color: #00ff00; font-size: 18px; margin-top: 30px; display: none;">
                    ğŸš€ Upgrading to modern interface...<br>
                    âœ¨ Adding colors and gradients...<br>
                    ğŸ’« Initializing smooth animations...<br>
                    ğŸ¨ Loading beautiful design...
                </p>
            </div>
        </div>
    </div>

    <!-- Modern App (Hidden Initially) -->
    <div id="modern-app" class="hidden w-full h-screen flex items-center justify-center p-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <!-- iPad æ¨¡æ“¬é‚Šæ¡† -->
        <div class="ipad-frame w-full max-w-4xl h-[90vh] bg-white/95 rounded-3xl flex flex-col overflow-hidden">
        
        <!-- Header (ç‹€æ…‹æ¬„) -->
        <header id="header-bar" class="p-5 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 flex justify-between items-center text-white shadow-lg">
            <div class="flex items-center space-x-2">
                <span id="ai-status" class="text-sm font-semibold bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm">âœ¨ å·²é€£ç·š</span>
            </div>
            <div class="text-xl font-bold" id="mode-display">
                ğŸ’¬ AI è¼”å°å°è©±
            </div>
            <button id="mode-toggle-btn" 
                    onclick="toggleMode()"
                    class="px-4 py-2 bg-white/90 hover:bg-white text-purple-600 text-sm font-semibold rounded-full transition duration-200 active:scale-95 shadow-lg hover:shadow-xl">
                ğŸ¯ é€²å…¥æ¸¬é©—
            </button>
        </header>

        <!-- ä¸»å…§å®¹å€ -->
        <main class="flex-grow p-6 overflow-y-auto hide-scrollbar relative bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
            
            <!-- Chat Mode -->
            <div id="chat-mode-view" class="space-y-4">
                <div id="messages-container" class="space-y-4 pb-4">
                    <!-- æ­¡è¿è¨Šæ¯ -->
                    <div class="flex justify-start message-slide-in">
                        <div class="bg-gradient-to-br from-purple-500 to-pink-500 text-white p-4 rounded-2xl rounded-tl-sm max-w-lg shadow-xl">
                            <p class="text-sm font-bold mb-2 flex items-center">ğŸ¤– AI è¼”å°å“¡</p>
                            <p class="leading-relaxed">æ‚¨å¥½ï¼æˆ‘æ˜¯ä¸€ä½ç¶“éå°ˆæ¥­é…ç½®çš„ AI è¼”å°å“¡ã€‚è«‹éš¨æ„æå‡ºé—œæ–¼é’æ˜¥æœŸã€èº«é«”è®ŠåŒ–ã€è¦ªå¯†é—œä¿‚æˆ–å®‰å…¨ç•Œç·šçš„å•é¡Œã€‚æˆ‘æœƒæä¾›æº–ç¢ºä¸”ä¸­ç«‹çš„è³‡è¨Šã€‚âœ¨</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quiz Mode -->
            <div id="quiz-mode-view" class="hidden flex flex-col items-center justify-center min-h-full p-4">
                <div class="w-full max-w-xl bg-white p-8 rounded-3xl shadow-2xl border-4 border-purple-300">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-6 pb-3 border-b-2 border-purple-200">ğŸ¯ æ€§æ•™è‚²çŸ¥è­˜æ¸¬é©—</h2>
                    <div id="quiz-content" class="text-gray-800">
                        <p class="text-lg font-medium text-center">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æ¸¬é©—ï¼ğŸš€</p>
                    </div>
                </div>
            </div>

        </main>

        <!-- è¼¸å…¥å€ -->
        <footer id="input-area" class="bg-white p-5 border-t-2 border-purple-200">
            <div id="chat-input-container" class="flex space-x-3">
                <input type="text" id="user-input" placeholder="ğŸ’­ è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ..."
                       class="flex-grow p-4 bg-gradient-to-r from-purple-100 to-pink-100 text-gray-800 border-2 border-purple-300 rounded-full focus:outline-none focus:ring-4 focus:ring-purple-300 placeholder-purple-400 transition duration-200 font-medium">
                <button id="send-btn" onclick="sendMessage()"
                        class="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold rounded-full transition duration-200 active:scale-95 shadow-lg hover:shadow-xl">
                    ğŸš€ ç™¼é€
                </button>
            </div>
            <div id="quiz-prompt" class="hidden text-center text-purple-600 py-2 font-medium">
                ğŸ“ è«‹åœ¨æ¸¬é©—å€å¡Šå®Œæˆä½œç­”ã€‚
            </div>
        </footer>

        </div><!-- End of iPad frame -->
    </div><!-- End of modern-app -->

    <script>
        // --- Page Transition Logic ---
        function startSystem() {
            const oldSchoolPage = document.getElementById('old-school-page');
            const loadingPage = document.getElementById('loading-page');
            const modernApp = document.getElementById('modern-app');
            const loadingContent = document.getElementById('loading-content');
            const transitionContent = document.getElementById('transition-content');
            const upgradeText = document.getElementById('upgrade-text');
            const cursor = document.getElementById('cursor');
            
            // Fade out old school page
            oldSchoolPage.classList.add('fade-out');
            
            setTimeout(() => {
                oldSchoolPage.classList.add('hidden');
                loadingPage.classList.remove('hidden');
                loadingPage.classList.add('fade-in');
                
                // Simulate loading progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 25;
                    if (progress > 100) progress = 100;
                    document.getElementById('progress').textContent = Math.floor(progress);
                    
                    if (progress >= 100) {
                        clearInterval(progressInterval);
                        
                        // Hide cursor and fade out loading content
                        cursor.style.display = 'none';
                        
                        setTimeout(() => {
                            loadingContent.classList.add('fade-out');
                            
                            setTimeout(() => {
                                loadingContent.style.display = 'none';
                                transitionContent.style.display = 'block';
                                
                                // Show the joke text
                                setTimeout(() => {
                                    // Start background morphing
                                    loadingPage.classList.add('morphing-bg');
                                    
                                    // Show upgrade text after joke
                                    setTimeout(() => {
                                        upgradeText.style.display = 'block';
                                        
                                        // Wait for animations to complete
                                        setTimeout(() => {
                                            // Final transition to modern app
                                            loadingPage.classList.add('fade-out');
                                            
                                            setTimeout(() => {
                                                loadingPage.classList.add('hidden');
                                                modernApp.classList.remove('hidden');
                                                modernApp.classList.add('scale-up');
                                            }, 800);
                                        }, 4000); // Wait for morphing animations
                                    }, 1500); // Delay before showing upgrade text
                                }, 300);
                            }, 500);
                        }, 500);
                    }
                }, 150);
            }, 500);
        }
        
        // --- æ ¸å¿ƒé…ç½® ---
        let currentMode = 'chat'; 
        
        // é—œéµï¼šæŒ‡å‘ Vercel éƒ¨ç½²çš„ Serverless Function è·¯å¾‘
        // Vercel æœƒè‡ªå‹•å°‡ /api/chat æ˜ å°„åˆ°æ‚¨éƒ¨ç½²çš„ chat.js æª”æ¡ˆ
        const API_URL = '/api/chat'; 
        
        // Gemini æ¨¡å‹é…ç½®èˆ‡ç³»çµ±æŒ‡ä»¤ (ç¢ºä¿å°ˆæ¥­æ€§)
        const SYSTEM_INSTRUCTION = "ä½ æ˜¯ä¸€ä½å°ˆæ¥­ã€ä¸­ç«‹ä¸”å¯Œæœ‰åŒç†å¿ƒçš„é’å°‘å¹´æ€§æ•™è‚²è¼”å°å“¡ã€‚ä½ çš„å›ç­”å¿…é ˆç°¡æ½”ã€å®‰å…¨ã€å®¢è§€ï¼Œä¸¦ä½¿ç”¨é©åˆé’å°‘å¹´çš„èªè¨€ã€‚é¿å…çµ¦äºˆé†«ç™‚å»ºè­°ï¼Œä¸¦å§‹çµ‚å¼·èª¿åŒæ„æ¬Šå’Œå€‹äººå®‰å…¨ã€‚";

        // --- æ¸¬é©—ç›¸é—œè®Šæ•¸èˆ‡é¡Œåº« ---
        let currentQuestionIndex = 0;
        let currentScore = 0;
        const quizQuestions = [
            {
                question: "1. é’æ˜¥æœŸèº«é«”ç™¼è‚²çš„é–‹å§‹é€šå¸¸ç”±ä»€éº¼æ¿€ç´ è§¸ç™¼ï¼Ÿ",
                options: ["é›Œæ¿€ç´  (Estrogen)", "çªå›ºé…® (Testosterone)", "ç”Ÿé•·æ¿€ç´  (Growth Hormone)", "èƒ°å³¶ç´  (Insulin)"],
                correctAnswer: "é›Œæ¿€ç´  (Estrogen)",
                explanation: "é’æ˜¥æœŸç™¼è‚²æ˜¯ç”±è…¦ä¸‹å‚é«”é‡‹æ”¾çš„æ¿€ç´ åˆºæ¿€åµå·¢æˆ–çªä¸¸ç”¢ç”Ÿé›Œæ¿€ç´ æˆ–çªé…®æ‰€è§¸ç™¼çš„ã€‚"
            },
            {
                question: "2. ä»€éº¼æ˜¯ã€åŒæ„æ¬Š (Consent)ã€çš„é—œéµè¦ç´ ï¼Ÿ",
                options: ["åªéœ€è¦ä¿æŒæ²‰é»˜å³å¯", "å¿…é ˆæ˜¯è‡ªé¡˜ã€æ¸…æ™°ä¸”æŒçºŒçš„", "åªéœ€è¦æˆå¹´äººåŒæ„", "å¿…é ˆæ˜¯å–®æ–¹é¢çš„"],
                correctAnswer: "å¿…é ˆæ˜¯è‡ªé¡˜ã€æ¸…æ™°ä¸”æŒçºŒçš„",
                explanation: "åŒæ„å¿…é ˆæ˜¯è‡ªé¡˜çµ¦äºˆçš„ã€æ¸…æ™°æ˜ç¢ºçš„ï¼Œä¸¦ä¸”å¯ä»¥éš¨æ™‚æ’¤å›ï¼ˆæŒçºŒæ€§ï¼‰ã€‚"
            },
            {
                question: "3. ç¶²è·¯è¦ªå¯†è¡Œç‚ºä¸­æœ€å¸¸è¦‹çš„é¢¨éšªæ˜¯ä»€éº¼ï¼Ÿ",
                options: ["æ‰‹æ©Ÿé›»é‡ä¸è¶³", "åœ–ç‰‡æª”æ¡ˆéå¤§", "å¤±å»å°ç…§ç‰‡å’Œè¨Šæ¯çš„æ§åˆ¶æ¬Š", "ä¸Šå‚³é€Ÿåº¦æ…¢"],
                correctAnswer: "å¤±å»å°ç…§ç‰‡å’Œè¨Šæ¯çš„æ§åˆ¶æ¬Š",
                explanation: "ä¸€æ—¦ç§å¯†å…§å®¹ç™¼é€å‡ºå»ï¼Œå°±æ°¸é ç„¡æ³•ä¿è­‰å®ƒä¸æœƒè¢«è¤‡è£½ã€åˆ†äº«æˆ–æ¿«ç”¨ã€‚"
            },
            {
                question: "4. ä»¥ä¸‹å“ªé …ä¸æ˜¯æ€§å‚³æŸ“ç—…ï¼ˆSTIï¼‰çš„é é˜²æ–¹æ³•ï¼Ÿ",
                options: ["ä½¿ç”¨ä¿éšªå¥—", "æ¥ç¨®ç–«è‹—ï¼ˆå¦‚ HPVï¼‰", "å®šæœŸæª¢æŸ¥", "å…±ç”¨ç‰™åˆ·"],
                correctAnswer: "å…±ç”¨ç‰™åˆ·",
                explanation: "å…±ç”¨ç‰™åˆ·èˆ‡æ€§å‚³æŸ“ç—…é é˜²ç„¡é—œã€‚å®‰å…¨æªæ–½åŒ…æ‹¬ä½¿ç”¨å±éšœã€æ¥ç¨®ç–«è‹—å’Œå®šæœŸç¯©æª¢ã€‚"
            },
            {
                question: "5. å¦‚æœå°è‡ªå·±çš„æ€§å‚¾å‘æˆ–æ€§åˆ¥èªåŒæ„Ÿåˆ°å›°æƒ‘ï¼Œæœ€å¥åº·çš„ä¸‹ä¸€æ­¥æ˜¯ï¼Ÿ",
                options: ["è‡ªå·±éš±è—èµ·ä¾†ï¼Œä¸è¦å‘Šè¨´ä»»ä½•äºº", "å°‹æ±‚å€¼å¾—ä¿¡ä»»çš„æˆå¹´äººæˆ–å°ˆæ¥­äººå£«è«®è©¢", "ç«‹åˆ»åšå‡ºæ±ºå®šä¸¦å…¬é–‹", "åœ¨ç¶²è·¯ä¸Šå°‹æ‰¾é™Œç”Ÿäººè¨è«–"],
                correctAnswer: "å°‹æ±‚å€¼å¾—ä¿¡ä»»çš„æˆå¹´äººæˆ–å°ˆæ¥­äººå£«è«®è©¢",
                explanation: "å°‹æ±‚å°ˆæ¥­è¼”å°æˆ–èˆ‡å€¼å¾—ä¿¡ä»»çš„æˆå¹´äººäº¤æµï¼Œæ˜¯æ¢ç´¢å€‹äººèº«ä»½çš„æœ€ä½³æ–¹å¼ã€‚"
            }
        ];


        // --- ä¸»è¦åŠŸèƒ½é‚è¼¯ ---

        async function sendMessage() {
            if (currentMode === 'quiz') return; 

            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            renderUserMessage(message);
            input.value = '';
            
            // é–å®šè¼¸å…¥å’Œç™¼é€æŒ‰éˆ•
            input.disabled = true;
            document.getElementById('send-btn').disabled = true;

            await streamAIResponse(message);

            // è§£é–è¼¸å…¥å’Œç™¼é€æŒ‰éˆ•
            input.disabled = false;
            document.getElementById('send-btn').disabled = false;
            input.focus();
        }

        // ä¸²æµ AI å›æ‡‰ (å‘¼å« Vercel ä»£ç†)
        async function streamAIResponse(prompt) {
            const container = document.getElementById('messages-container');
            const aiMessage = document.createElement('div');
            aiMessage.className = 'flex justify-start message-slide-in';
            aiMessage.innerHTML = `
                <div class="bg-gradient-to-br from-purple-500 to-pink-500 text-white p-4 rounded-2xl rounded-tl-sm max-w-lg shadow-xl">
                    <p class="text-sm font-bold mb-2 flex items-center">ğŸ¤– AI è¼”å°å“¡</p>
                    <div id="ai-response-${Date.now()}" class="text-base leading-relaxed"><span class="pulse-animation">ğŸ’­ æ€è€ƒä¸­...</span></div>
                </div>
            `;
            container.appendChild(aiMessage);
            const responseElement = aiMessage.querySelector('div.text-base');

            // æ»¾å‹•åˆ°åº•éƒ¨
            container.scrollTop = container.scrollHeight;

            try {
                // 1. å‘ Vercel ä»£ç†ç™¼é€è«‹æ±‚
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    // å°‡ Gemini æ‰€éœ€çš„çµæ§‹ï¼ˆåŒ…æ‹¬ç³»çµ±æŒ‡ä»¤ï¼‰ç™¼é€çµ¦ Vercel ä»£ç†
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: SYSTEM_INSTRUCTION }] }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    responseElement.innerHTML = `<span class="text-red-400">é€£ç·šéŒ¯èª¤æˆ–å¯†é‘°ç„¡æ•ˆ:</span> è«‹æª¢æŸ¥ä»£ç†ä¼ºæœå™¨æˆ– Vercel ç’°å¢ƒè®Šæ•¸ã€‚`;
                    return;
                }
                
                // 2. è™•ç†ä¸²æµ
                const reader = response.body.getReader();
                const decoder = new TextDecoder("utf-8");
                
                responseElement.textContent = ''; // æ¸…é™¤ '...æ€è€ƒä¸­'
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    // Vercel ä»£ç†æœƒå°‡åŸå§‹å›æ‡‰ä¸²æµè½‰ç™¼å›ä¾†
                    const chunk = decoder.decode(value, { stream: true });
                    responseElement.textContent += chunk;
                    container.scrollTop = container.scrollHeight;
                }

            } catch (error) {
                console.error("Fetch Error:", error);
                responseElement.innerHTML = `<span class="text-red-400">ç¶²è·¯æˆ–ä»£ç†æ•…éšœ:</span> è«‹æª¢æŸ¥é€£ç·šæˆ– Vercel éƒ¨ç½²ã€‚`;
            }
        }

        // æ¸²æŸ“ä½¿ç”¨è€…è¨Šæ¯ (èˆ‡å…ˆå‰ç‰ˆæœ¬ç›¸åŒ)
        function renderUserMessage(text) {
            const container = document.getElementById('messages-container');
            const messageElement = document.createElement('div');
            messageElement.className = 'flex justify-end message-slide-in';
            messageElement.innerHTML = `
                <div class="bg-gradient-to-br from-blue-500 to-cyan-400 text-white p-4 rounded-2xl rounded-br-sm max-w-lg shadow-xl">
                    <p class="text-base leading-relaxed font-medium">${text}</p>
                </div>
            `;
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
        }

        // ç¶å®š Enter éµ (èˆ‡å…ˆå‰ç‰ˆæœ¬ç›¸åŒ)
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // --- æ¸¬é©—æ¨¡å¼é‚è¼¯ (èˆ‡å…ˆå‰ç‰ˆæœ¬ç›¸åŒ) ---
        function toggleMode() {
            const chatView = document.getElementById('chat-mode-view');
            const quizView = document.getElementById('quiz-mode-view');
            const toggleBtn = document.getElementById('mode-toggle-btn');
            const inputContainer = document.getElementById('chat-input-container');
            const quizPrompt = document.getElementById('quiz-prompt');
            const modeDisplay = document.getElementById('mode-display');

            if (currentMode === 'chat') {
                currentMode = 'quiz';
                chatView.classList.add('hidden');
                quizView.classList.remove('hidden');
                toggleBtn.innerHTML = 'ğŸ’¬ è¿”å›å°è©±';
                modeDisplay.innerHTML = 'ğŸ¯ çŸ¥è­˜é»æ¸¬é©—';
                inputContainer.classList.add('hidden');
                quizPrompt.classList.remove('hidden');
                
                currentQuestionIndex = 0;
                currentScore = 0;
                renderQuiz();

            } else {
                currentMode = 'chat';
                chatView.classList.remove('hidden');
                quizView.classList.add('hidden');
                toggleBtn.innerHTML = 'ğŸ¯ é€²å…¥æ¸¬é©—';
                modeDisplay.innerHTML = 'ğŸ’¬ AI è¼”å°å°è©±';
                inputContainer.classList.remove('hidden');
                quizPrompt.classList.add('hidden');
            }
        }

        function renderQuiz() {
            const quizContent = document.getElementById('quiz-content');

            if (currentQuestionIndex >= quizQuestions.length) {
                const scorePercent = Math.round((currentScore / quizQuestions.length) * 100);
                const emoji = scorePercent >= 80 ? 'ğŸ‰' : scorePercent >= 60 ? 'ğŸ‘' : 'ğŸ’ª';
                quizContent.innerHTML = `
                    <div class="text-center p-8 bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl border-2 border-purple-300">
                        <div class="text-6xl mb-4">${emoji}</div>
                        <h3 class="text-3xl font-bold mb-4 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">æ¸¬é©—å®Œæˆï¼</h3>
                        <p class="text-xl mb-4 text-gray-700">æ‚¨çš„æœ€çµ‚åˆ†æ•¸æ˜¯ï¼š</p>
                        <div class="text-5xl font-extrabold bg-gradient-to-r from-blue-600 to-cyan-500 bg-clip-text text-transparent mb-4">${currentScore} / ${quizQuestions.length}</div>
                        <p class="text-lg text-gray-600 mb-6">æŒæ¡åº¦ï¼š${scorePercent}% ğŸ’¯</p>
                        <button onclick="toggleMode()" class="mt-4 px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold rounded-full transition duration-200 shadow-lg hover:shadow-xl active:scale-95">
                            ğŸ’¬ è¿”å›å°è©±æ¨¡å¼
                        </button>
                    </div>
                `;
                return;
            }

            const questionData = quizQuestions[currentQuestionIndex];
            const optionsContainer = document.createElement('div');
            optionsContainer.id = 'quiz-options';
            optionsContainer.className = 'mt-4 space-y-3';
            
            let optionsHTML = '';
            questionData.options.forEach((option, i) => {
                optionsHTML += `
                    <button onclick="checkAnswer(${i})" 
                            id="option-btn-${i}"
                            class="quiz-option-btn w-full p-5 my-2 text-left rounded-2xl transition-all 
                                   bg-gradient-to-r from-purple-100 to-pink-100 hover:from-purple-200 hover:to-pink-200 
                                   border-2 border-purple-300 hover:border-purple-400
                                   disabled:opacity-75 disabled:cursor-not-allowed text-base font-semibold shadow-md hover:shadow-lg
                                   transform hover:scale-105 active:scale-95 text-gray-800">
                        <span class="text-purple-600">${String.fromCharCode(65 + i)}.</span> ${option}
                    </button>
                `;
            });

            quizContent.innerHTML = `
                <div class="mb-6">
                    <p class="text-sm font-semibold text-purple-600 mb-3 bg-purple-100 inline-block px-4 py-2 rounded-full">ğŸ“Š ç¬¬ ${currentQuestionIndex + 1} é¡Œ / å…± ${quizQuestions.length} é¡Œ</p>
                    <h3 class="text-xl font-bold text-gray-800 leading-relaxed">${questionData.question}</h3>
                </div>
                ${optionsHTML}
            `;
        }

        function checkAnswer(selectedIndex) {
            const question = quizQuestions[currentQuestionIndex];
            const isCorrect = question.correctAnswer === question.options[selectedIndex];
            const optionsContainer = document.getElementById('quiz-options');
            const buttons = optionsContainer.querySelectorAll('button');

            buttons.forEach(button => {
                button.disabled = true;
                button.classList.remove('hover:from-purple-200', 'hover:to-pink-200', 'hover:scale-105', 'hover:border-purple-400'); 
            });

            buttons.forEach((button, index) => {
                if (index === selectedIndex) {
                    if (isCorrect) {
                        button.className = 'quiz-option-btn w-full p-5 my-2 text-left rounded-2xl transition-all bg-gradient-to-r from-green-400 to-emerald-500 ring-4 ring-green-300 text-white font-bold shadow-xl';
                        button.innerHTML = 'âœ… ' + button.innerHTML;
                    } else {
                        button.className = 'quiz-option-btn w-full p-5 my-2 text-left rounded-2xl transition-all bg-gradient-to-r from-red-400 to-pink-500 ring-4 ring-red-300 text-white font-bold shadow-xl';
                        button.innerHTML = 'âŒ ' + button.innerHTML;
                    }
                }
                
                if (question.options[index] === question.correctAnswer && index !== selectedIndex) {
                    button.className = 'quiz-option-btn w-full p-5 my-2 text-left rounded-2xl transition-all bg-gradient-to-r from-green-500 to-emerald-600 ring-4 ring-green-400 text-white font-bold shadow-xl';
                    button.innerHTML = 'âœ… ' + button.innerHTML;
                }
            });

            if (isCorrect) {
                currentScore++;
            }

            setTimeout(() => {
                currentQuestionIndex++;
                renderQuiz();
            }, 2000); 
        }

    </script>
</body>
</html>
